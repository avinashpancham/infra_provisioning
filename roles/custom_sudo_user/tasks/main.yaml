- name: Check required variables
  fail:
    msg: 'Variable {{ item }} is not defined'
  when: item not in vars
  with_items: '{{ required_vars }}'
- name: Add user
  user:
    name: '{{ user }}'
    group: admin   
    state: present 
- name: Allow paswordless sudo with user
  ansible.builtin.lineinfile:
    path: /etc/sudoers
    line: '{{ user }} ALL=(ALL) NOPASSWD: ALL'
    state: present